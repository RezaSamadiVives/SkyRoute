@model SkyRoute.ViewModels.MealSelectionFormVM

@{
    ViewData["Title"] = "Maaltijdkeuze";
}

<main>
    @Html.AntiForgeryToken()

    <div class="container py-5">
        <h2 class="mb-4">Kies jouw gewenste maaltijd per passagier en per vlucht</h2>

        <div class="accordion" id="passengerAccordion">
            @for (int p = 0; p < Model.PassengerMeals.Count; p++)
            {
                var passenger = Model.PassengerMeals[p];
                <div class="accordion-item mb-3">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-@p" aria-expanded="false" aria-controls="collapse-@p">
                            @passenger.Passenger.FirstName @passenger.Passenger.LastName
                        </button>
                    </h2>
                    <div id="collapse-@p" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            @for (int f = 0; f < passenger.FlightMeals.Count; f++)
                            {
                                var flightMeal = passenger.FlightMeals[f];
                                <div class="card p-3 mb-3">
                                    <h5>
                                        @flightMeal.Flight.FlightNumber - @flightMeal.Flight.FromCity.Name â†’
                                        @flightMeal.Flight.ToCity.Name
                                    </h5>
                                    @foreach (var meal in flightMeal.AvailableMeals)
                                    {
                                        var radioId = $"meal_{p}_{f}_{meal.Id}";
                                        var radioName = $"meal_{p}_{f}";
                                        <div class="form-check d-flex align-items-center mb-3">
                                            <input class="form-check-input meal-radio" type="radio" name="@radioName" id="@radioId"
                                                value="@meal.Id" data-passenger-id="@passenger.Passenger.Id"
                                                data-flight-id="@flightMeal.Flight.Id" />
                                            <label class="form-check-label d-flex align-items-center w-100" for="@radioId">
                                                <img src="@(string.IsNullOrEmpty(meal.ImageUrl) ? Url.Content("~/images/mealoptions/meal.jpeg") : meal.ImageUrl)"
                                                    alt="@meal.Name"
                                                    style="width: 60px; height: 60px; object-fit: cover; border-radius: 5px; margin-right: 15px;" />
                                                <div>
                                                    <strong>@meal.Name</strong><br />
                                                    <small class="text-muted">@meal.Description</small>
                                                    @if (meal.IsLocalMeal)
                                                    {
                                                        <span class="badge bg-success ms-2">Lokaal</span>
                                                    }
                                                </div>
                                            </label>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                </div>

            }
        </div>
        <div class="mt-4">
            <a id="continueBtn" class="btn btn-primary disabled" href="@Url.Action("Index", "Home")">
                Verder met boeken
            </a>
        </div>
    </div>

    <!-- Bootstrap Modal voor fouten -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="messageModalLabel">Foutmelding</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Sluiten"></button>
                </div>
                <div class="modal-body" id="messageModalBody">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Sluiten</button>
                </div>
            </div>
        </div>
    </div>




</main>
@section Scripts {
    <script src="~/js/mealSelectForm.js?v=@DateTime.Now.Ticks"></script>
}